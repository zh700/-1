import{I as w,d as de,a as u,r as ie,A as me,e as i,o as z,c as O,b as l,w as a,k as d,h as R,t as T,p as h,m as pe,F as D,n as ce,x as F,J as U,_ as fe}from"./index-kmnJ3fi5.js";import{u as ve}from"./setting-BzEky4I2.js";const ge=(r,m,V)=>w.get(`/admin/acl/user/${r}/${m}/?username=${V}`),ye=r=>r.id?w.put("/admin/acl/user/update",r):w.post("/admin/acl/user/save",r),we=r=>w.get("/admin/acl/user/toAssign/"+r),be=r=>w.post("/admin/acl/user/doAssignRole",r),Ve=r=>w.delete("/admin/acl/user/remove/"+r),_e=r=>w.delete("/admin/acl/user/batchRemove",{data:r}),Ce={style:{flex:"auto"}},ke={style:{flex:"auto"}},Ue=de({__name:"UserView",setup(r){const m=u(1),V=u(5),I=u(0),x=u([]),f=u(!1),n=ie({username:"",name:"",password:""}),v=u(),b=u(!1),S=u(!1),q=u(!0),_=u([]),C=u([]),A=u([]),k=u(""),E=ve();me(()=>{g()});const g=async(o=1)=>{m.value=o;const e=await ge(m.value,V.value,k.value);e.code==200&&(I.value=e.data.total,x.value=e.data.records)},M=()=>{g()},H=()=>{f.value=!0,Object.assign(n,{id:0,username:"",name:"",password:""}),F(()=>{v.value.clearValidate("username"),v.value.clearValidate("name"),v.value.clearValidate("password")})},J=o=>{f.value=!0,Object.assign(n,o),F(()=>{v.value.clearValidate("username"),v.value.clearValidate("name")})},G=async()=>{await v.value.validate(),(await ye(n)).code==200?(f.value=!1,U({type:"success",message:n.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,U({type:"error",message:n.id?"更新失败":"添加失败"}))},K=()=>{f.value=!1},Q={username:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("用户名字至少5个字符"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("用户昵称至少5个字符"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=6?s():s(new Error("用户密码至少6位"))}}]},W=async o=>{b.value=!0,Object.assign(n,o);const e=await we(n.id);e.code==200&&(_.value=e.data.allRolesList,C.value=e.data.assignRoles,b.value=!0)},X=o=>{C.value=o?_.value:[],q.value=!1},Y=o=>{const e=o.length;S.value=e===_.value.length,q.value=e>0&&e<_.value.length},Z=async()=>{const o={userId:n.id,roleIdList:C.value.map(s=>s.id)};(await be(o)).code==200&&(U({type:"success",message:"分配角色成功"}),b.value=!1,g(m.value))},ee=async o=>{(await Ve(o)).code==200&&(U({type:"success",message:"删除成功"}),g(x.value.length>1?m.value:m.value-1))},le=o=>{A.value=o},ae=async()=>{const o=A.value.map(s=>s.id);(await _e(o)).code==200&&(U({type:"success",message:"删除成功"}),g(x.value.length>1?m.value:m.value-1))},te=()=>{g(),k.value=""},oe=()=>{E.refsh=!E.refsh};return(o,e)=>{const s=i("el-input"),y=i("el-form-item"),p=i("el-button"),$=i("el-form"),N=i("el-card"),c=i("el-table-column"),ne=i("el-popconfirm"),se=i("el-table"),re=i("el-pagination"),L=i("el-drawer"),P=i("el-checkbox"),ue=i("el-checkbox-group");return z(),O(D,null,[l(N,null,{default:a(()=>[l($,{inline:!0,class:"form"},{default:a(()=>[l(y,{label:"用户名："},{default:a(()=>[l(s,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(y,null,{default:a(()=>[l(p,{type:"primary",size:"default",disabled:!k.value,onClick:te},{default:a(()=>e[12]||(e[12]=[d("搜索")])),_:1},8,["disabled"]),l(p,{type:"primary",size:"default",onClick:oe},{default:a(()=>e[13]||(e[13]=[d("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l(N,{style:{margin:"10px 0px"}},{default:a(()=>[l(p,{type:"primary",size:"default",onClick:H},{default:a(()=>e[14]||(e[14]=[d("添加用户")])),_:1}),l(p,{type:"primary",size:"default",disabled:!A.value.length,onClick:ae},{default:a(()=>e[15]||(e[15]=[d("批量删除")])),_:1},8,["disabled"]),l(se,{onSelectionChange:le,style:{margin:"10px 0px"},data:x.value},{default:a(()=>[l(c,{type:"selection",align:"center"}),l(c,{label:"#",align:"center",type:"index"}),l(c,{label:"ID",align:"center",prop:"id"}),l(c,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(c,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),l(c,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(c,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(c,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(c,{label:"操作",width:"300px",align:"center"},{default:a(({row:t,$index:j})=>[l(p,{type:"primary",size:"default",icon:"User",onClick:B=>W(t)},{default:a(()=>e[16]||(e[16]=[d("分配角色")])),_:2},1032,["onClick"]),l(p,{type:"primary",size:"default",icon:"Edit",onClick:B=>J(t)},{default:a(()=>e[17]||(e[17]=[d("编辑")])),_:2},1032,["onClick"]),l(ne,{title:`你确定要删除${t.username}吗?`,width:"260px",onConfirm:B=>ee(t.id)},{reference:a(()=>[l(p,{type:"primary",size:"default",icon:"Delete"},{default:a(()=>e[18]||(e[18]=[d("删除")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(re,{"current-page":m.value,"onUpdate:currentPage":e[1]||(e[1]=t=>m.value=t),"page-size":V.value,"onUpdate:pageSize":e[2]||(e[2]=t=>V.value=t),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total ",total:I.value,onSizeChange:M,onCurrentChange:g},null,8,["current-page","page-size","total"])]),_:1}),l(L,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t)},{header:a(()=>[R("h4",null,T(n.id?"更新用户":"添加用户"),1)]),default:a(()=>[l($,{model:n,rules:Q,ref_key:"formRef",ref:v},{default:a(()=>[l(y,{label:"用户姓名",prop:"username"},{default:a(()=>[l(s,{placeholder:"请你输入用户姓名",modelValue:n.username,"onUpdate:modelValue":e[3]||(e[3]=t=>n.username=t)},null,8,["modelValue"])]),_:1}),l(y,{label:"用户昵称",prop:"name"},{default:a(()=>[l(s,{placeholder:"请你输入用户昵称",modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=t=>n.name=t)},null,8,["modelValue"])]),_:1}),n.id?pe("",!0):(z(),h(y,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[l(s,{placeholder:"请你输入用户密码",modelValue:n.password,"onUpdate:modelValue":e[5]||(e[5]=t=>n.password=t)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:a(()=>[R("div",Ce,[l(p,{onClick:K},{default:a(()=>e[19]||(e[19]=[d("取消")])),_:1}),l(p,{type:"primary",onClick:G},{default:a(()=>e[20]||(e[20]=[d("确定")])),_:1})])]),_:1},8,["modelValue"]),l(L,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=t=>b.value=t)},{header:a(()=>e[21]||(e[21]=[R("h4",null,"分配角色",-1)])),default:a(()=>[l($,null,{default:a(()=>[l(y,{label:"用户姓名"},{default:a(()=>[l(s,{modelValue:n.username,"onUpdate:modelValue":e[7]||(e[7]=t=>n.username=t),disabled:!0},null,8,["modelValue"])]),_:1}),l(y,{label:"职位列表"},{default:a(()=>[l(P,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=t=>S.value=t),indeterminate:q.value,onChange:X},{default:a(()=>e[22]||(e[22]=[d(" 全选 ")])),_:1},8,["modelValue","indeterminate"]),l(ue,{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=t=>C.value=t),onChange:Y},{default:a(()=>[(z(!0),O(D,null,ce(_.value,(t,j)=>(z(),h(P,{key:j,label:t},{default:a(()=>[d(T(t.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:a(()=>[R("div",ke,[l(p,{onClick:e[10]||(e[10]=t=>b.value=!1)},{default:a(()=>e[23]||(e[23]=[d("取消")])),_:1}),l(p,{type:"primary",onClick:Z},{default:a(()=>e[24]||(e[24]=[d("确定")])),_:1})])]),_:1},8,["modelValue"])],64)}}}),Ae=fe(Ue,[["__scopeId","data-v-36f9564b"]]);export{Ae as default};
