import{I as k,d as X,a as u,r as Y,A as Z,e as r,o as ee,c as le,b as l,w as t,k as m,h as N,F as te,x as oe,J as z,_ as ae}from"./index-kmnJ3fi5.js";import{u as ne}from"./setting-BzEky4I2.js";const se=(p,i,g)=>k.get(`/admin/acl/role/${p}/${i}/?roleName=${g}`),re=p=>p.id?k.put("/admin/acl/role/update",p):k.post("/admin/acl/role/save",p),ie=p=>k.get("/admin/acl/permission/toAssign/"+p),de=(p,i)=>k.post(`/admin/acl/permission/doAssign/?roleId=${p}&permissionId=${i}`),ue={class:"dialog-footer"},pe={style:{flex:"auto"}},me=X({__name:"RoleView",setup(p){const i=u(1),g=u(10),y=u(""),w=u([]),R=u(0),$=ne(),c=u(!1),s=Y({roleName:""}),C=u(),_=u(!1),x=u([]),S=u([]),V=u();Z(()=>{f()});const f=async(n=1)=>{i.value=n;const e=await se(i.value,g.value,y.value);e.code==200&&(R.value=e.data.total,w.value=e.data.records)},E=()=>{f()},j=()=>{f(),y.value=""},O=()=>{$.refsh=!$.refsh},T=()=>{c.value=!0,Object.assign(s,{roleName:"",id:0}),oe(()=>{C.value.clearValidate("roleName")})},B=n=>{c.value=!0,Object.assign(s,n)},L={roleName:[{required:!0,trigger:"blur",validator:(n,e,a)=>{e.trim().length>=2?a():a(new Error("职位名称至少2个字符"))}}]},M=async()=>{await C.value.validate(),(await re(s)).code==200&&(z({type:"success",message:s.id?"更新成功":"添加成功"}),c.value=!1,f(s.id?i.value:1))},D=async n=>{_.value=!0,Object.assign(s,n);const e=await ie(s.id);e.code==200&&(x.value=e.data,S.value=U(x.value,[]))},U=(n,e)=>(n.forEach(a=>{a.select&&a.children==0&&e.push(a.id),a.children&&a.children.length>0&&U(a.children,e)}),e),F={children:"children",label:"name"},H=async()=>{const n=s.id,e=V.value.getCheckedKeys(),a=V.value.getHalfCheckedKeys(),b=e.concat(a);(await de(n,b)).code==200&&(_.value=!1,z({type:"success",message:"分配权限成功"})),window.location.reload()},q=async n=>{(await q()).code==200&&(z({type:"success",message:"删除成功"}),f(w.value.length>1?i.value:i.value-1))};return(n,e)=>{const a=r("el-input"),b=r("el-form-item"),d=r("el-button"),A=r("el-form"),I=r("el-card"),v=r("el-table-column"),K=r("el-popconfirm"),h=r("el-table"),J=r("el-pagination"),G=r("el-dialog"),Q=r("el-tree"),W=r("el-drawer");return ee(),le(te,null,[l(I,null,{default:t(()=>[l(A,{inline:!0,class:"from"},{default:t(()=>[l(b,{label:"职位搜索"},{default:t(()=>[l(a,{placeholder:"请你输入搜索职位的关键字",modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=o=>y.value=o)},null,8,["modelValue"])]),_:1}),l(b,null,{default:t(()=>[l(d,{type:"primary",size:"default",disabled:!y.value,onClick:j},{default:t(()=>e[8]||(e[8]=[m("搜索")])),_:1},8,["disabled"]),l(d,{type:"primary",size:"default",onClick:O},{default:t(()=>e[9]||(e[9]=[m("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l(I,{style:{margin:"10px 0px"}},{default:t(()=>[l(d,{type:"primary",size:"default",icon:"Plus",onClick:T},{default:t(()=>e[10]||(e[10]=[m("添加职位")])),_:1}),l(h,{border:"",style:{margin:"10px 0px"},data:w.value},{default:t(()=>[l(v,{type:"index",align:"center",label:"#"}),l(v,{label:"ID",align:"center",prop:"id"}),l(v,{label:"职位名称",align:"center","show-overflow-tooltip":"",prop:"roleName"}),l(v,{label:"创建时间",align:"center","show-overflow-tooltip":"",prop:"creatTime"}),l(v,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(v,{label:"操作",width:"280px"},{default:t(({row:o,$index:fe})=>[l(d,{type:"primary",size:"small",icon:"User",onClick:P=>D(o)},{default:t(()=>e[11]||(e[11]=[m("分配权限")])),_:2},1032,["onClick"]),l(d,{type:"primary",size:"small",icon:"Edit",onClick:P=>B(o)},{default:t(()=>e[12]||(e[12]=[m("编辑")])),_:2},1032,["onClick"]),l(K,{title:`你确定要删除${o.roleName}吗?`,width:"260px",onConfirm:P=>q(o.id)},{reference:t(()=>[l(d,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>e[13]||(e[13]=[m("删除")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(J,{"current-page":i.value,"onUpdate:currentPage":e[1]||(e[1]=o=>i.value=o),"page-size":g.value,"onUpdate:pageSize":e[2]||(e[2]=o=>g.value=o),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:R.value,onSizeChange:E,onCurrentChange:f},null,8,["current-page","page-size","total"])]),_:1}),l(G,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=o=>c.value=o),title:s.id?"更新职位":"添加职位"},{footer:t(()=>[N("div",ue,[l(d,{type:"primary",onClick:e[4]||(e[4]=o=>c.value=!1)},{default:t(()=>e[14]||(e[14]=[m("取消")])),_:1}),l(d,{type:"primary",onClick:M},{default:t(()=>e[15]||(e[15]=[m("确定")])),_:1})])]),default:t(()=>[l(A,{model:s,rules:L,ref_key:"from",ref:C},{default:t(()=>[l(b,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(a,{placeholder:"请你输入职位名称",modelValue:s.roleName,"onUpdate:modelValue":e[3]||(e[3]=o=>s.roleName=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=o=>_.value=o)},{header:t(()=>e[16]||(e[16]=[N("h4",null,"分配菜单与按钮的权限",-1)])),default:t(()=>[l(Q,{ref_key:"tree",ref:V,style:{"max-width":"600px"},data:x.value,"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":S.value,props:F},null,8,["data","default-checked-keys"])]),footer:t(()=>[N("div",pe,[l(d,{type:"primary",onClick:e[6]||(e[6]=o=>_.value=!1)},{default:t(()=>e[17]||(e[17]=[m("取消")])),_:1}),l(d,{type:"primary",onClick:H},{default:t(()=>e[18]||(e[18]=[m("确定")])),_:1})])]),_:1},8,["modelValue"])],64)}}}),ye=ae(me,[["__scopeId","data-v-1fb9bfd6"]]);export{ye as default};
