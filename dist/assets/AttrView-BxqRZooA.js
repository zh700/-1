import{d as F,M,a as b,r as T,v as G,N as Q,G as H,e as u,o as f,c as V,b as e,O as K,w as n,y as x,h as L,i as W,k as p,F as X,n as Y,p as A,t as z,z as I,x as B,P as Z,J as m,Q as ee,R as te}from"./index-kmnJ3fi5.js";const ae=["onClick"],ne=F({__name:"AttrView",setup(le){const c=M(),y=b([]),d=b(0),$=b([]),_=te(),a=T({id:0,attrName:"string",attrValueList:[],categoryId:"",categoryLevel:3});G(()=>c.c3Id,async()=>{y.value=[],c.c3Id&&g()});const g=async()=>{const{c1Id:r,c2Id:t,c3Id:o}=c,l=await Q(r,t,o);l.code==200&&(y.value=l.data)},O=()=>{Object.assign(a,{id:0,attrName:"string",attrValueList:[],categoryId:c.c3Id,categoryLevel:3}),d.value=1},S=r=>{d.value=1,Object.assign(a,JSON.parse(JSON.stringify(r)))},N=()=>{d.value=0},h=()=>{a.attrValueList.push({valueName:"",flag:!0}),B(()=>{$.value[a.attrValueList.length-1].focus()})},P=async()=>{(await Z(a)).code==200?(d.value=0,m({type:"success",message:a.id?"修改成功":"添加成功"}),g()):m({type:"error",message:a.id?"修改失败":"添加失败"})},U=(r,t)=>{if(r.valueName.trim()==""){a.attrValueList.splice(t,1),m({type:"error",message:"属性值不能为空"});return}if(a.attrValueList.find(l=>{if(l!=r)return l.valueName===r.valueName})){a.attrValueList.splice(t,1),m({type:"error",message:"属性值已存在"});return}r.flag=!1},w=(r,t)=>{r.flag=!0,B(()=>{const o=_==null?void 0:_.proxy;if(o){const l=o.$refs[`inputRef_${t}`];l&&l.focus()}})},D=async r=>{(await ee(r)).code==200?(m({type:"success",message:"删除成功"}),g()):m({type:"error",message:"删除失败"})};return H(()=>{c.$reset()}),(r,t)=>{const o=u("el-button"),l=u("el-table-column"),E=u("el-tag"),R=u("el-popconfirm"),k=u("el-table"),C=u("el-input"),q=u("el-form-item"),J=u("el-form"),j=u("el-card");return f(),V("div",null,[e(K,{scene:d.value},null,8,["scene"]),e(j,{style:{margin:"10px 0px"}},{default:n(()=>[x(L("div",null,[e(o,{type:"primary",size:"default",icon:"Plus",disabled:!W(c).c3Id,onClick:O},{default:n(()=>t[1]||(t[1]=[p("添加属性")])),_:1},8,["disabled"]),e(k,{border:"",style:{margin:"10px 0px"},data:y.value},{default:n(()=>[e(l,{label:"序号",type:"index",align:"center",width:"80px"}),e(l,{label:"属性名称",width:"120px",prop:"attrName"}),e(l,{label:"属性值名称"},{default:n(({row:s})=>[(f(!0),V(X,null,Y(s.attrValueList,i=>(f(),A(E,{style:{margin:"5px"},key:i.id},{default:n(()=>[p(z(i.valueName),1)]),_:2},1024))),128))]),_:1}),e(l,{label:"操作",width:"120px"},{default:n(({row:s})=>[e(o,{size:"small",type:"primary",icon:"Edit",onClick:i=>S(s)},null,8,["onClick"]),e(R,{title:`你确定删除${s.attrName}吗？`,width:"200px",onConfirm:i=>D(s.id)},{reference:n(()=>[e(o,{size:"small",type:"primary",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])],512),[[I,d.value==0]]),x(L("div",null,[e(J,{inline:!0},{default:n(()=>[e(q,{label:"属性名称"},{default:n(()=>[e(C,{placeholder:"请你输入属性名称",modelValue:a.attrName,"onUpdate:modelValue":t[0]||(t[0]=s=>a.attrName=s)},null,8,["modelValue"])]),_:1})]),_:1}),e(o,{onClick:h,disabled:!a.attrName,type:"primary",size:"default",icon:"Plus"},{default:n(()=>t[2]||(t[2]=[p("添加属性值")])),_:1},8,["disabled"]),e(o,{type:"primary",size:"default",onClick:N},{default:n(()=>t[3]||(t[3]=[p("取消")])),_:1}),e(k,{border:"",style:{margin:"10px 0px"},data:a.attrValueList},{default:n(()=>[e(l,{label:"序号",width:"80px",type:"index",align:"center"}),e(l,{label:"属性值名称"},{default:n(({row:s,$index:i})=>[s.flag?(f(),A(C,{key:0,ref:`inputRef_${i}`,size:"small",onBlur:v=>U(s,i),placeholder:"请你输入属性值名称",modelValue:s.valueName,"onUpdate:modelValue":v=>s.valueName=v},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(f(),V("div",{key:1,onClick:v=>w(s,i)},z(s.valueName),9,ae))]),_:1}),e(l,{label:"属性值操作"},{default:n(({index:s})=>[e(o,{type:"primary",size:"small",icon:"Delete",onClick:i=>a.attrValueList.splice(s,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),e(o,{type:"primary",size:"default",icon:"Plus",onClick:P,disabled:!(a.attrValueList.length>0)},{default:n(()=>t[4]||(t[4]=[p("保存")])),_:1},8,["disabled"]),e(o,{type:"primary",size:"default",onClick:N},{default:n(()=>t[5]||(t[5]=[p("取消")])),_:1})],512),[[I,d.value==1]])]),_:1})])}}});export{ne as default};
