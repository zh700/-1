import{I as N,d as X,a as c,S as se,e as o,o as f,c as z,b as e,w as t,F as E,n as H,p as $,i as ee,U as de,h as j,k as q,t as re,J as B,r as ie,N as pe,M as ce,v as me,G as _e,y as Q,z as W}from"./index-kmnJ3fi5.js";const ve=(g,V,I)=>N.get(`/admin/product/${g}/${V}?category3Id=${I}`),Y=()=>N.get("/admin/product/baseTrademark/getTrademarkList"),le=g=>N.get("/admin/product/spuImageList/"+g),te=g=>N.get("/admin/product/spuSaleAttrList/"+g),Z=()=>N.get("/admin/product/baseSaleAttrList"),fe=g=>g.id?N.post("/admin/product/updateSpuInfo",g):N.post("/admin/product/saveSpuInfo",g),ge=g=>N.post("/admin/product/saveSkuInfo",g),Se=g=>N.get("/admin/product/findBySpuId/"+g),ye=g=>N.delete("/admin/product/deleteSpu/"+g),be=["src"],Ve=X({__name:"spuForm",emits:["changeScene"],setup(g,{expose:V,emit:I}){const x=c([]),S=c([]),y=c([]),C=c([]),i=c(""),D=c(!1),m=c({category3Id:"",description:"",spuName:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),A=c(""),U=I,M=()=>{U("changeScene",0)},w=async()=>{m.value.spuImageList=S.value.map(l=>({imgName:l.name,imgUrl:l.response&&l.response.data||l.url})),m.value.spuSaleAttrList=y.value,(await fe(m.value)).code==200?(B({type:"success",message:m.value.id?"更新成功":"添加成功"}),U("changeScene",{flag:0,params:m.value.id?"update":"add"})):B({type:"success",message:m.value.id?"更新成功":"添加成功"})},u=async a=>{m.value=a;const l=await Y(),r=await le(a.id),s=await te(a.id),h=await Z();x.value=l.data,S.value=r.data.map(L=>({name:L.imgName,url:L.imgUrl})),y.value=s.data,C.value=h.data},p=a=>{i.value=a.url,D.value=!0},_=(a,l)=>{console.log(a,l)},k=se(()=>C.value.filter(l=>y.value.every(r=>l.name!=r.saleAttrName))),K=()=>{const[a,l]=A.value.split(":"),r={baseSaleAttrId:a,saleAttrName:l,spuSaleAttrValueList:[]};y.value.push(r),A.value=""},v=a=>{a.flag=!0,a.saleAttrValue=""},d=a=>{const{baseSaleAttrId:l,saleAttrValue:r}=a,s={baseSaleAttrId:l,saleAttrValueName:r};if((r==null?void 0:r.trim())==""){B({type:"error",message:"属性值不能为空"});return}if(a.spuSaleAttrValueList.find(L=>L.saleAttrValueName==r)){B({type:"error",message:"属性值已存在"});return}a.spuSaleAttrValueList.push(s),a.flag=!1};return V({initHasSpuData:u,initAddSpu:async a=>{Object.assign(m.value,{category3Id:"",description:"",spuName:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),S.value=[],y.value=[],A.value="",m.value.category3Id=a;const l=await Y(),r=await Z();x.value=l.data,C.value=r.data}}),(a,l)=>{const r=o("el-input"),s=o("el-form-item"),h=o("el-option"),L=o("el-select"),G=o("el-icon"),b=o("el-upload"),J=o("el-dialog"),P=o("el-button"),R=o("el-table-column"),ae=o("el-tag"),ne=o("el-table"),ue=o("el-form");return f(),z("div",null,[e(ue,{"label-width":"100px"},{default:t(()=>[e(s,{label:"SPU名称"},{default:t(()=>[e(r,{placeholder:"请你输入SPU名称",modelValue:m.value.spuName,"onUpdate:modelValue":l[0]||(l[0]=n=>m.value.spuName=n)},null,8,["modelValue"])]),_:1}),e(s,{label:"SPU品牌"},{default:t(()=>[e(L,{modelValue:m.value.tmId,"onUpdate:modelValue":l[1]||(l[1]=n=>m.value.tmId=n)},{default:t(()=>[(f(!0),z(E,null,H(x.value,(n,O)=>(f(),$(h,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"SPU描述"},{default:t(()=>[e(r,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:m.value.description,"onUpdate:modelValue":l[2]||(l[2]=n=>m.value.description=n)},null,8,["modelValue"])]),_:1}),e(s,{label:"SPU图片"},{default:t(()=>[e(b,{"file-list":S.value,"onUpdate:fileList":l[3]||(l[3]=n=>S.value=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":p,"on-remove":_},{default:t(()=>[e(G,null,{default:t(()=>[e(ee(de))]),_:1})]),_:1},8,["file-list"]),e(J,{modelValue:D.value,"onUpdate:modelValue":l[4]||(l[4]=n=>D.value=n)},{default:t(()=>[j("img",{"w-full":"",src:i.value,alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,be)]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"SPU销售属性"},{default:t(()=>[e(L,{modelValue:A.value,"onUpdate:modelValue":l[5]||(l[5]=n=>A.value=n),placeholder:k.value.length?`还未选择${k.value.length}个`:"无"},{default:t(()=>[(f(!0),z(E,null,H(k.value,(n,O)=>(f(),$(h,{value:`${n.id}:${n.name}`,key:n.id,label:n.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue","placeholder"]),e(P,{onClick:K,disabled:!A.value,style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus"},{default:t(()=>l[6]||(l[6]=[q("添加属性值")])),_:1},8,["disabled"]),e(ne,{border:"",style:{margin:"10px 0px"},data:y.value},{default:t(()=>[e(R,{label:"序号",type:"index",align:"center",width:"80px"}),e(R,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(R,{label:"销售属性值"},{default:t(({row:n,$index:O})=>[(f(!0),z(E,null,H(n.spuSaleAttrValueList,(F,oe)=>(f(),$(ae,{style:{margin:"0px 5px"},onClose:Ue=>n.spuSaleAttrValueList.splice(oe,1),key:n.id,closable:""},{default:t(()=>[q(re(F.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.flag==!0?(f(),$(r,{key:0,onBlur:F=>d(n),modelValue:n.saleAttrValue,"onUpdate:modelValue":F=>n.saleAttrValue=F,placeholder:"请输入你的属性值",size:"small",style:{width:"100px"}},null,8,["onBlur","modelValue","onUpdate:modelValue"])):(f(),$(P,{key:1,onClick:F=>v(n),type:"primary",size:"small",icon:"Plus"},null,8,["onClick"]))]),_:1}),e(R,{label:"操作",width:"120px"},{default:t(({row:n,$index:O})=>[e(P,{type:"primary",size:"small",icon:"Delete",onClick:F=>y.value.splice(O,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(s,null,{default:t(()=>[e(P,{disabled:!(y.value.length>0),type:"primary",size:"default",onClick:w},{default:t(()=>l[7]||(l[7]=[q("保存")])),_:1},8,["disabled"]),e(P,{type:"primary",size:"default",onClick:M},{default:t(()=>l[8]||(l[8]=[q("取消")])),_:1})]),_:1})]),_:1})])}}}),ke=["src"],Ie=X({__name:"skuForm",emits:["changeScene"],setup(g,{expose:V,emit:I}){const x=c([]),S=c([]),y=c([]),C=c(),i=ie({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),D=async(w,u,p)=>{i.category3Id=p.category3Id,i.spuId=p.id,i.tmId=p.tmId;const _=await pe(w,u,p.category3Id),k=await te(p.id),K=await le(p.id);x.value=_.data,S.value=k.data,y.value=K.data},m=w=>{y.value.forEach(u=>{C.value.toggleRowSelection(u,!1)}),C.value.toggleRowSelection(w,!0),i.skuDefaultImg=w.imgUrl},A=async()=>{i.skuAttrValueList=x.value.reduce((u,p)=>{if(p.attrIdAndValueId){const[_,k]=p.attrIdAndValueId.split(":");return u.push({attrId:_,valueId:k}),u}},[]),i.skuSaleAttrValueList=S.value.reduce((u,p)=>{if(p.saleIdAndValueId){const[_,k]=p.saleIdAndValueId.split(":");return u.push({saleId:_,saleValueId:k}),u}},[]),(await ge(i)).code===200?(B({type:"success",message:"添加SKU成功"}),U("changeScene",{flag:0,params:""})):B({type:"error",message:"添加SKU失败"})},U=I,M=()=>{U("changeScene",{flag:0,params:""})};return V({initSkuData:D}),(w,u)=>{const p=o("el-input"),_=o("el-form-item"),k=o("el-option"),K=o("el-select"),v=o("el-form"),d=o("el-table-column"),T=o("el-button"),a=o("el-table");return f(),$(v,null,{default:t(()=>[e(_,{label:"SKU名称"},{default:t(()=>[e(p,{placeholder:"SKU名称",modelValue:i.skuName,"onUpdate:modelValue":u[0]||(u[0]=l=>i.skuName=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"价格(元)"},{default:t(()=>[e(p,{placeholder:"价格(元)",type:"number",modelValue:i.price,"onUpdate:modelValue":u[1]||(u[1]=l=>i.price=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"重量(g)"},{default:t(()=>[e(p,{placeholder:"重量(g)",type:"number",modelValue:i.weight,"onUpdate:modelValue":u[2]||(u[2]=l=>i.weight=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"SKU描述"},{default:t(()=>[e(p,{placeholder:"SKU描述",type:"textarea",modelValue:i.skuDesc,"onUpdate:modelValue":u[3]||(u[3]=l=>i.skuDesc=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"平台属性"},{default:t(()=>[e(v,{inline:!0},{default:t(()=>[(f(!0),z(E,null,H(x.value,(l,r)=>(f(),$(_,{key:l.id,label:l.attrName},{default:t(()=>[e(K,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":s=>l.attrIdAndValueId=s},{default:t(()=>[(f(!0),z(E,null,H(l.attrValueList,(s,h)=>(f(),$(k,{key:s.id,label:s.valueName,value:`${l.id}:${s.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"销售属性"},{default:t(()=>[e(v,{inline:!0},{default:t(()=>[(f(!0),z(E,null,H(S.value,(l,r)=>(f(),$(_,{key:l.id,label:l.saleAttrName},{default:t(()=>[e(K,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":s=>l.saleIdAndValueId=s},{default:t(()=>[(f(!0),z(E,null,H(l.spuSaleAttrValueList,(s,h)=>(f(),$(k,{key:s.id,label:s.saleAttrValueName,value:`${l.id}:${s.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(_,{label:"图片名称"},{default:t(()=>[e(a,{border:"",data:y.value,ref_key:"table",ref:C},{default:t(()=>[e(d,{type:"selection",width:"80px",align:"center"}),e(d,{label:"图片"},{default:t(({row:l,$index:r})=>[j("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,ke)]),_:1}),e(d,{label:"名称",prop:"imgName"}),e(d,{label:"操作"},{default:t(({row:l,$index:r})=>[e(T,{type:"primary",size:"small",onClick:s=>m(l)},{default:t(()=>u[4]||(u[4]=[q("设置默认")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(a,null,{default:t(()=>[e(_,null,{default:t(()=>[e(T,{type:"primary",size:"default",onClick:A},{default:t(()=>u[5]||(u[5]=[q("保存")])),_:1}),e(T,{type:"primary",size:"default",onClick:M},{default:t(()=>u[6]||(u[6]=[q("取消")])),_:1})]),_:1})]),_:1})]),_:1})}}}),Ae=["src"],Ce=X({__name:"SpuView",setup(g){const V=c(0),I=c(1),x=c(3),S=ce(),y=c([]),C=c(0),i=c(),D=c(),m=c([]),A=c(!1);me(()=>S.c3Id,()=>{S.c3Id&&U()});const U=async(v=1)=>{I.value=v;const d=await ve(I.value,x.value,S.c3Id);d.code==200&&(y.value=d.data.records,C.value=d.data.total)},M=()=>{U()},w=()=>{V.value=1,i.value.initAddSpu(S.c3Id)},u=v=>{V.value=v.flag,v.params=="update"?U(I.value):U()},p=v=>{V.value=1,i.value.initHasSpuData(v)},_=v=>{V.value=2,D.value.initSkuData(S.c1Id,S.c2Id,v)},k=async v=>{let d=await Se(v.id);d.code==200&&(m.value=d.data,A.value=!0)},K=async v=>{(await ye(v.id)).code==200?(B({type:"success",message:"删除成功"}),U(y.value.length>1?I.value:I.value-1)):B({type:"error",message:"删除失败"})};return _e(()=>{S.$reset()}),(v,d)=>{const T=o("CategoryC"),a=o("el-button"),l=o("el-table-column"),r=o("el-popconfirm"),s=o("el-table"),h=o("el-pagination"),L=o("el-dialog"),G=o("el-card");return f(),z("div",null,[e(T,{scene:V.value},null,8,["scene"]),e(G,{style:{margin:"10px 0px"}},{default:t(()=>[Q(j("div",null,[e(a,{onClick:w,type:"primary",size:"default",icon:"Plus",disabled:ee(S).c3Id},{default:t(()=>d[3]||(d[3]=[q("添加SPU")])),_:1},8,["disabled"]),e(s,{style:{margin:"10px 0px"},border:"",data:y.value},{default:t(()=>[e(l,{label:"序号",type:"index",align:"center",width:"80px"}),e(l,{label:"SPU名称",prop:"spuName"}),e(l,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(l,{label:"SPU操作"},{default:t(({row:b,$index:J})=>[e(a,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:P=>_(b)},null,8,["onClick"]),e(a,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:P=>p(b)},null,8,["onClick"]),e(a,{type:"primary",size:"small",icon:"View",title:"查看SKU列表",onClick:P=>k(b)},null,8,["onClick"]),e(r,{title:`你确定删除${b.spuName}吗？`,width:"200px",onConfirm:P=>K(b)},{reference:t(()=>[e(a,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(h,{"current-page":I.value,"onUpdate:currentPage":d[0]||(d[0]=b=>I.value=b),"page-size":x.value,"onUpdate:pageSize":d[1]||(d[1]=b=>x.value=b),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper,->,total, sizes,",total:C.value,onCurrentChange:U,onSizeChange:M},null,8,["current-page","page-size","total"])],512),[[W,V.value==0]]),Q(e(Ve,{ref_key:"spu",ref:i,onChangeScene:u},null,512),[[W,V.value==1]]),Q(e(Ie,{ref_key:"sku",ref:D,onChangeScene:u},null,512),[[W,V.value==2]]),e(L,{title:"SKU列表",modelValue:A.value,"onUpdate:modelValue":d[2]||(d[2]=b=>A.value=b)},{default:t(()=>[e(s,{border:"",data:m.value},{default:t(()=>[e(l,{prop:"skuName",label:"SKU名字"}),e(l,{prop:"price",label:"SKU价格"}),e(l,{prop:"weight",label:"SKU重量"}),e(l,{label:"SKU图片"},{default:t(({row:b,$index:J})=>[j("img",{src:b.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Ae)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}});export{Ce as default};
